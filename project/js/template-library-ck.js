$(function(){$.fn.serializeObject=function(){var e={},t=this.serializeArray();$.each(t,function(){if(e[this.name]!==undefined){e[this.name].push||(e[this.name]=[e[this.name]]);e[this.name].push(this.value||"")}else e[this.name]=this.value||""});return e};var e=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?n:n&7|8).toString(16)});return t};Task={};Task.el=$(".wrapper .project");Task.form=$(".project-form");Task.addTaskHead=function(e){e="<h3 class='task-head'>Tasks for today</h3>";Task.el.append(e)};Task.addTaskForm=function(t){t='<div class=\'form-task-add\'><div class=\'wrap\'><form method="post" class=\'form-task-add-form\'><label>Please enter name</label><input name="name" id="task-name" type="text" /><label>Please enter description</label><textarea id="task-desc" name="desc" type="text" rows="4" cols="30"></textarea><input class="btn-add" type="submit" value="create task" /></form></div></div>';Task.form.append(t);$(".select-js").select2()};Task.submitForm=function(t){t.preventDefault();var n=$(t.target),r=n.serializeObject();r.status="new";r.id=e();n.find("#task-name").val("");n.find("#task-desc").val("");$.ajax({type:"POST",contentType:"application/json",url:"https://api.mongolab.com/api/1/databases/tasks/collections/tasks/?apiKey=Ju3FZxiia5y2QvDT14KcUp7TwO_JceQA",dataType:"json",data:JSON.stringify(r)}).done(function(e){Tasks.push(e);Task.renderItem(e)})};Task.editContent=function(e){_target=$(e.target);var t=_target.closest("div[data-id]").data("id"),n=_.findWhere(Tasks,{id:t});Tasks[Tasks.indexOf(n)].name=$("div[data-id="+t+"]").find(".task-name").text();Tasks[Tasks.indexOf(n)].desc=$("div[data-id="+t+"]").find(".task-desc").text()};Task.template=_.template("<div data-id=\"<%= id %>\" class='task-item'><div class='cube'><i class='cube-top'></i><div class='task-layout'><div class='task-name' contentEditable=\"true\"> <%= name %> </div><div class='task-desc' contentEditable=\"true\"> <%= desc %>  </div><div class='task-status <%= status %>'><p><%= status %></p></div><a href=\"javascript:;\" class='btn-delete'>delete task</a><div class='change-status' ><a href=\"javascript:;\" class='btn-change-status'>change status</a><div class='choice' ><a href=\"javascript:;\" class='status-todo'>todo</a><a href=\"javascript:;\" class='status-inprogress'>inporgress</a><a href=\"javascript:;\" class='status-done'>done</a></div></div></div><i class='cube-bottom-shadow'></i></div></div>");Task.renderItem=function(e){var t=Task.template(e);$(t).insertAfter(".filter");$(".btn-delete").on("click",Task.removeItem);$(".task-name").on("blur",Task.editContent);$(".task-desc").on("blur",Task.editContent)};Task.removeItem=function(e){e.preventDefault();e.stopPropagation();var t=$(e.target),n=t.closest("div[data-id]").data("id");t.unbind("click");var r=_.findWhere(Tasks,{id:n});$.ajax({type:"DELETE",url:"https://api.mongolab.com/api/1/databases/tasks/collections/tasks/"+r._id.$oid+"?apiKey=Ju3FZxiia5y2QvDT14KcUp7TwO_JceQA&codekitCB=408204034.041171",async:!0}).done(function(e){Tasks.pop(r);t.closest(".task-item").hide("slow",function(){$(this).closest(".task-item").remove()})})};Task.changeStatus=function(e){e.preventDefault();var t=$(e.target);$(t).next(".choice").fadeToggle("slow","linear")};Task.init=function(){Task.addTaskForm();$(".form-task-add-form").on("submit",Task.submitForm);_.each(Tasks,this.renderItem);$(".btn-change-status").on("click",Task.changeStatus);Task.offlineEvent()};Task.offlineEvent=function(){window.addEventListener("load",function(e){window.applicationCache&&window.applicationCache.addEventListener("updateready",function(e){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){window.applicationCache.swapCache();confirm("A new version of this site is available. Load it?")&&window.location.reload()}},!1)},!1);$(document).on("offline online",function(e){alert("You are "+e.type+"!")})};Task.init()});